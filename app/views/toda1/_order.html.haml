%tr
  %td
    - if order.order_type_id == 1 || order.order_type_id == 2
      %div{style:'display:flex; justify-content: flex-end'}
        = link_to 'https://mail.google.com/mail/u/0/#search/'+order.uid, target:["_blank"] do
          #copytext
            = order.uid
        %button.copybtn{type: "button"}
          %i.fas.fa-copy

    - if order.order_type_id == 3
      %div{style:'display:flex; justify-content: flex-end'}
        = link_to 'https://mail.google.com/mail/u/0/#search/'+order.uid, target:["_blank"] do
          #copytext
            #fubi
              = order.uid
        %button.copybtn{type: "button"}
          %i.fas.fa-copy

    - if order.order_type_id == 4 || order.order_type_id == 5 || order.order_type_id == 6 || order.order_type_id == 7 || order.order_type_id == 8
      %div{style:'display:flex; justify-content: flex-end'}
        = link_to 'https://mail.google.com/mail/u/0/#search/'+order.uid, target:["_blank"] do
          #copytext
            #kono
              = order.uid
        %button.copybtn{type: "button"}
          %i.fas.fa-copy

  %td
    - if order.customer.customer_type_id == 1
      .overflow-tooltip
        %span{title: "#{order.customer.customer_name} 様"}
          = link_to customer_path(id: order.customer.uid) do
            #{order.customer.customer_type.customer_type_name}
            #{order.customer.customer_name} 様

    - if order.customer.customer_type_id == 2
      .overflow-tooltip{id: 'fubi'}
        %span{title: "#{order.customer.customer_name} 様"}
          = link_to customer_path(id: order.customer.uid) do
            #{order.customer.customer_type.customer_type_name}
            #{order.customer.customer_name} 様

  %td
    = link_to customer_path(id: order.customer.uid) do
      %i.fas.fa-history
      #{Order.where(customer_id: order.customer_id).count}

  %td
    = OrderType.find(order.order_type_id).order_type_name.truncate(8)
    = QuoteDifficultyLevel.find(order.quote_difficulty_level_id).quote_difficulty_level_name

  %td
    = l(order.try(:order_date), format: :middle, default: '')

  %td
    - if order.representative_user_id == 1
      %p{style: 'color:lightgray'}
        = User.find(order.representative_user_id).user_name
    - else
      = User.find(order.representative_user_id).user_name

  %td
    - OrderAddress.where(order_id: order.id).each do |oa|
      - if PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id.between?(1, 2) || PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id == 28 || PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id.between?(31, 47)
        %p{id: 'fubi'}
          = PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).name
          %br
      - elsif PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id == 11 || PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id == 13 || PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).id == 49
        %p{id: 'lightblue'}
          = PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).name
          %br
      - else
        = PrefectureCode.find(CustomerAddress.find(oa.customer_address_id).prefecture_code).name
        %br

  %td
    - if order.desired_delivery_date.present?
      - if order.desired_delivery_type_id == 1
        %p{id: 'red'}
          #{l(order.try(:desired_delivery_date), format: :middle, default: '')}必着

      - elsif order.desired_delivery_type_id == 2
        %p{id: 'red'}
          #{l(order.try(:desired_delivery_date), format: :middle, default: '')}までに

      - elsif order.desired_delivery_type_id == 3
        %p{id: 'green'}
          #{l(order.try(:desired_delivery_date), format: :middle, default: '')}前後

      - elsif order.desired_delivery_type_id == 4
        %p{id: 'green'}
          #{l(order.try(:desired_delivery_date), format: :middle, default: '')}前後

  %td{style: "font-weight:bold"}
    - if order.internal_delivery_date.present?
      - if order.desired_delivery_type_id == 1
        %p{id: 'red'}
          #{l(order.try(:internal_delivery_date), format: :middle, default: '')}

      - elsif order.desired_delivery_type_id == 2
        %p{id: 'red'}
          #{l(order.try(:internal_delivery_date), format: :middle, default: '')}

      - elsif order.desired_delivery_type_id == 3
        %p{id: 'green'}
          #{l(order.try(:internal_delivery_date), format: :middle, default: '')}

      - elsif order.desired_delivery_type_id == 4
        %p{id: 'green'}
          #{l(order.try(:internal_delivery_date), format: :middle, default: '')}

  %td
    - if order.payment_amount.nil?
      %i.fab.fa-creative-commons-nc-jp{style:'font-size:10px; color:#333'}
      不要
    - elsif order.difference >= 0
      %i.far.fa-check-circle{style:'font-size:10px; color:#333'}
      #{number_to_currency(order.payment_amount, format: "%u%n", unit: "¥")}
    - elsif order.difference < 0
      #fubi
        %i.fas.fa-times-circle
        #{number_to_currency(order.payment_amount, format: "%u%n", unit: "¥")}

  - #海外発注のみ等、判定をどうするか...
  %td{align: "left"}
    - if BuyDetail.where(order_id: order.id).blank?
      #fubi
        %i.fas.fa-times-circle
        未発注
    - BuyDetail.where(order_id: order.id).each do |buy_detail|
      - if buy_detail.buy_progress_id == 1
        #lightblue
          %i.fas.fa-hourglass-half{style:'font-size:10px; color:#333'}
          作業中
      - elsif buy_detail.buy_progress_id == 2
        .overflow-tooltip
          %i.far.fa-check-circle{style:'font-size:10px; color:#333'}
          - BuyNote.where(buy_detail_id: buy_detail.id).each do |buy_note|
            %span{title: "#{buy_note.buy_note}"}
              #{buy_note.buy_note}
              %br/


    - OrderNote.where(order_id: order.id).each do |order_note|
      %td{align: "left"}
        .overflow-tooltip
          %span{title: "#{order_note.order_note}"}
            #{order_note.order_note}

  %td
    = button_to '詳細・変更', edit_order_path(id: order.uid), method: :get
  -#
  -# .container
  -#   %tbody
  -#     %tr
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#       %td
  -#



    -#.container
    -#  %tbody
    -#    %tr
    -#    - OrderDetail.where(order_id: order.id).each do |order_detail|
    -#      %td{align: "right"}
    -#        ↳
    -#      %td
    -#        - if order_detail.mixed_techniques == "mixed"
    -#          合体加工
    -#        - else
    -#          単体加工
    -#      - OrderTechniqueDetail.where(order_detail_id: order_detail.id).each do |order_technique_detail|
    -#        %tbody
    -#          %td
    -#          %td{align: "right"}
    -#            ↳
    -#          %td
    -#            = Technique.find(order_technique_detail.technique_id).technique_name
    -#            %br
    -#            - OrderTechniqueDetailOption.where(order_detail_id: order_detail.id).each do |order_technique_detail_option|
    -#              #{TechniqueOption.find(order_technique_detail_option.technique_option_id).technique_option_name}
    -#              %br
    -#              - OrderDetailOption.where(order_detail_id: order_detail.id).each do |order_detail_option|
    -#                #{OrderOption.find(order_detail_option.order_option_id).order_option_name}
    -#          %td
    -#            #{Factory.find(order_detail.factory_id).factory_name}工場
    -#          %td
    -#            -# - unless order_technique_detail.progress_id == 1
    -#            #{Progress.find(order_technique_detail.progress_id).progress_name}
    -#          %td
    -#            - unless order_technique_detail.pasteup_user_id == 1
    -#              🐔#{User.find(order_technique_detail.pasteup_user_id).user_name}
    -#          %td
    -#            - unless order_technique_detail.maker_id == 1
    -#              🍗#{User.find(order_technique_detail.maker_id).user_name}

      -#%td
        - OrderDetail.where(order_id: order.id).each do |order_detail|
          - SortDetail.where(order_detail_id: order_detail).each do |sort_detail|
            済(#{User.find(sort_detail.sorting_user_id).user_name})
            %br/